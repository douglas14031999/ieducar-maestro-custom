import{g as Oe,a as oe,y as Pe,X as z,z as me,A as ke,w as be,b as Q,s as Ee,q as ge,_ as F,e as ye,f as he,B as Le,d as De,C as Ve,D as Be,E as ve,F as Ue,H as Fe,I as fe,J as qe,K as Me,L as ze}from"./common.wmfdqs9ndo.js";import{d as ee,g as V,r as f,E as _e,o as r,c,a as e,$ as Z,p as _,A as y,m as D,j as C,a2 as le,F as X,l as K,s as G,t as p,_ as je,K as Ge,a1 as xe,u as He,x as We,z as Ye,i as Je,R as Xe,w as Ke,q as Qe}from"./vendor.wmfdqs9ndo.js";import{p as Ze,l as es,a as ss,b as ts,g as os,c as as}from"./shared/prepregistrations-subscription/preregistrations.wmfdqs9ndo.js";import{R as ls,S as ns}from"./shared/prepregistrations-subscription/processes.wmfdqs9ndo.js";const rs=async M=>{var b,N;const I=await Oe({variables:{name:M,first:10},query:`
      query searchLegacyStudents($name: String!, $first: Int!) {
        legacyStudents: searchLegacyStudentsByName(name: $name, first: $first) {
          id
          name
          cpf
          dateOfBirth
          responsibleName
          responsibleCpf
          responsibleDateOfBirth
          responsiblePhone
        }
      }
    `});return(N=(b=I==null?void 0:I.data)==null?void 0:b.data)!=null&&N.legacyStudents?I.data.data.legacyStudents:[]},is={class:"row mt-5"},ds={class:"col-12 col-md-6"},us=ee({__name:"Match",props:{student:{},fields:{},process:{},stage:{},errors:{}},setup(M){const S=M,I=oe(),b=V(()=>{var x,L;const i=I.isAuthenticated,E=(L=(x=S.stage)==null?void 0:x.allowSearch)!=null?L:!1;return i&&E}),N=f(0),R={student_cpf:{required:!1,show:!1},student_rg:{required:!1,show:!1},student_birth_certificate:{required:!1,show:!1}};S.fields.student.filter(i=>["student_cpf","student_rg","student_birth_certificate"].includes(i.id)).forEach(i=>Object.assign(R,{[i.id]:{required:i.required,show:!0}}));const g=_e(S,"student"),B=V(()=>{var i;return((i=S.process)==null?void 0:i.minimumAge)||0}),U=V({get:()=>g.value.student_name||"",set:i=>{g.value.student_name=i}});function T(i){N.value++,i.dateOfBirth&&(g.value.student_date_of_birth=i.dateOfBirth),g.value.student_cpf=i.cpf?me(i.cpf):"",g.value.responsible_name=i.responsibleName||"",g.value.responsible_cpf=i.responsibleCpf?me(i.responsibleCpf):"",i.responsibleDateOfBirth&&(g.value.responsible_date_of_birth=i.responsibleDateOfBirth),g.value.responsible_phone=i.responsiblePhone?ke(i.responsiblePhone):""}return(i,E)=>(r(),c("div",null,[E[5]||(E[5]=e("h2",{class:"font-muli-20-primary mb-4"}," Identifique o(a) aluno(a) para continuar com a inscri\xE7\xE3o: ",-1)),E[6]||(E[6]=e("p",null,[Z(" Preencha os dados abaixo para identificar o(a) "),e("strong",null,"aluno(a)"),Z(" que ser\xE1 matr\xEDculado(a). ")],-1)),e("div",is,[e("div",ds,[_(Pe,{modelValue:U.value,"onUpdate:modelValue":E[0]||(E[0]=x=>U.value=x),label:"Nome do(a) aluno(a)",name:"student_name",rules:"required",errors:!!i.errors.student_name,"fetch-suggestions":y(rs),searchable:b.value,onSelect:T},null,8,["modelValue","errors","fetch-suggestions","searchable"])]),(r(),D(z,{key:N.value,modelValue:y(g).student_date_of_birth,"onUpdate:modelValue":E[1]||(E[1]=x=>y(g).student_date_of_birth=x),"container-class":"col-12 col-md-6",label:"Data de nascimento do(a) aluno(a)",name:"student_date_of_birth",rules:`required|date|minimum_age:${B.value}`,type:"DATE",errors:!!i.errors.student_date_of_birth},null,8,["modelValue","rules","errors"])),R.student_cpf.show?(r(),D(z,{key:0,modelValue:y(g).student_cpf,"onUpdate:modelValue":E[2]||(E[2]=x=>y(g).student_cpf=x),"container-class":"col-12 col-md-6",label:"CPF do(a) aluno(a)",name:"student_cpf",rules:R.student_cpf.required?"required|cpf":"cpf",type:"CPF",errors:!!i.errors.student_cpf},null,8,["modelValue","rules","errors"])):C("",!0),R.student_rg.show?(r(),D(z,{key:1,modelValue:y(g).student_rg,"onUpdate:modelValue":E[3]||(E[3]=x=>y(g).student_rg=x),"container-class":"col-12 col-md-6",label:"RG do(a) aluno(a)",name:"student_rg",rules:R.student_rg.required?"required|rg|max:20":"rg|max:20",type:"RG",errors:!!i.errors.student_rg},null,8,["modelValue","rules","errors"])):C("",!0),R.student_birth_certificate.show?(r(),D(z,{key:2,modelValue:y(g).student_birth_certificate,"onUpdate:modelValue":E[4]||(E[4]=x=>y(g).student_birth_certificate=x),"container-class":"col-12 col-md-8",label:"Certid\xE3o de Nascimento do(a) aluno(a)",name:"student_birth_certificate",rules:R.student_birth_certificate.required?"required|max:32":"max:32",type:"BIRTH_CERTIFICATE",errors:!!i.errors.student_birth_certificate},null,8,["modelValue","rules","errors"])):C("",!0)])]))}}),cs={class:"container-pmd"},ps={class:"m-auto",style:{"max-width":"340px"}},ms={key:0,class:"font-weight-bold"},vs={key:1,class:"font-weight-bold"},fs={key:0},bs={key:1},Es={class:"pull-right text-right",style:{width:"120px",height:"90px"}},gs=["src","alt"],ys={class:"mb-0"},hs={class:"font-hind-18-primary font-weight-bold"},_s={class:"mb-0"},xs={key:0,class:"mb-0"},Ss={class:"text-muted text-size-10 mt-4"},Ts={class:"text-dark"},Cs=["innerHTML"],ws={class:"text-center mt-5 mb-4"},Ns={class:"row mb-5"},$s={class:"col-12 col-md-4 offset-md-2"},As={class:"col-12 col-md-4"},Is={class:"row"},Rs={class:"col-12 col-md-5 offset-md-1 mb-4"},Os={class:"col-12 col-md-5 mb-4"},Ps=ee({__name:"Protocol",props:{preregistrations:{},process:{},student:{},responsible:{}},emits:["finish"],setup(M,{emit:S}){const I=le("$filters"),b=S,N=M,{dialog:R}=be(),{loader:g,loading:B}=Q(),U=oe(),T=f(),i=f({email:!1}),E=_e(N,"process"),x=V(()=>({fields:[{type:"EMAIL",label:"",name:"email",rules:"required|email",containerClass:"col-12"}],buttons:[{type:"submit",label:"Prosseguir",class:"btn btn-block btn-primary",containerClass:"mt-3",block:!0}],buttonsContainer:{class:""}})),L=()=>{window.print()},d=()=>{i.value.email=!0,T.value=N.responsible.responsible_email},a=l=>{g(()=>Ze({email:l.email,preregistrations:N.preregistrations.map(s=>s.id)})).then(s=>{s?i.value.email=!1:R({title:"Erro!",description:"N\xE3o foi poss\xEDvel enviar o e-mail.",iconLeft:"status-left",titleClass:"danger"})})},n=()=>{b("finish")};return(l,s)=>(r(),c("div",cs,[s[12]||(s[12]=e("h2",{class:"font-muli-20-primary mb-4 text-center"}," Sua inscri\xE7\xE3o foi realizada com sucesso! ",-1)),s[13]||(s[13]=e("p",{class:"mb-4"},[Z(" Para acompanhar a atualiza\xE7\xE3o da Pr\xE9-matr\xEDcula, n\xE3o esque\xE7a de anotar/salvar o(s) c\xF3digo(s) do(s) "),e("strong",null,"protocolo(s)"),Z(" gerado(s). ")],-1)),e("div",ps,[l.preregistrations.length===1?(r(),c("p",ms," Seu protocolo: ")):C("",!0),l.preregistrations.length>1?(r(),c("p",vs," Seus protocolos: ")):C("",!0),(r(!0),c(X,null,K(l.preregistrations,w=>(r(),c("div",{key:w.id,class:"mt-4"},[_(ge,{bordered:"",class:"protocol m-auto"},{default:G(()=>[_(Ee,null,{default:G(()=>[w.type==="WAITING_LIST"?(r(),c("div",fs,s[2]||(s[2]=[e("div",{class:"alert badge-yellow text-center text-uppercase"}," Lista de espera ",-1)]))):(r(),c("div",bs,s[3]||(s[3]=[e("div",{class:"alert badge-blue text-center text-uppercase"}," Pr\xE9-matr\xEDcula ",-1)]))),e("div",Es,[e("img",{src:y(U).logo,alt:y(U).entity.city,height:"90"},null,8,gs)]),e("dl",ys,[s[4]||(s[4]=e("dt",{class:"mt-3"},"C\xF3digo do protocolo",-1)),e("dd",hs," #"+p(w.protocol),1),l.process.showPriorityProtocol?(r(),D(Le,{key:0,preregistration:w},null,8,["preregistration"])):C("",!0),s[5]||(s[5]=e("dt",{class:"mt-3"},"Data da solicita\xE7\xE3o",-1)),e("dd",null,p(y(I).formatDateTime(w.date)),1),s[6]||(s[6]=e("dt",{class:"mt-3"},"Nome do(a) aluno(a)",-1)),e("dd",null,p(l.student.student_name),1),s[7]||(s[7]=e("dt",{class:"mt-3"},"S\xE9rie/Turno",-1)),e("dd",null,p(w.grade.name)+" / "+p(w.period.name),1),s[8]||(s[8]=e("dt",{class:"mt-3"},"Escola",-1)),e("dd",null,[e("p",_s,p(w.school.name),1),w.school.phone?(r(),c("p",xs," Telefone: "+p(`(${w.school.area_code}) ${w.school.phone}`),1)):C("",!0)])]),e("div",Ss,[s[9]||(s[9]=e("span",{class:"text-uppercase"},"C\xF3digo de autenticidade:",-1)),s[10]||(s[10]=e("br",null,null,-1)),e("span",Ts,p(w.code),1)])]),_:2},1024)]),_:2},1024)]))),128))]),e("div",{class:"mt-5 text-center",innerHTML:y(E).messageFooter},null,8,Cs),e("div",ws,[e("div",Ns,[e("div",$s,[_(F,{color:"primary",outline:"",label:"Imprimir",class:"w-100 mb-2",size:"lg","no-caps":"","no-wrap":"",onClick:L})]),e("div",As,[_(F,{color:"primary",outline:"",label:"Enviar por e-mail",class:"w-100",size:"lg","no-caps":"","no-wrap":"",onClick:d})])]),e("div",Is,[e("div",Rs,[_(F,{color:"primary",label:"Nova Inscri\xE7\xE3o",outline:"",class:"w-100",size:"lg","no-caps":"","no-wrap":"",onClick:n})]),e("div",Os,[_(F,{color:"primary",label:"Voltar para a tela inicial",class:"w-100 border-primary",size:"lg","no-caps":"","no-wrap":"",onClick:s[0]||(s[0]=w=>l.$router.push("/"))})])])]),_(he,{modelValue:i.value.email,"onUpdate:modelValue":s[1]||(s[1]=w=>i.value.email=w),title:"Enviar protocolo(s) por e-mail","no-footer":""},{body:G(()=>[s[11]||(s[11]=e("p",null," Preencha o campo abaixo com o e-mail que deve receber o(s) protocolo(s): ",-1)),_(ye,{schema:x.value,loading:y(B),onSubmit:a},null,8,["schema","loading"])]),_:1},8,["modelValue"])]))}});const ks=je(Ps,[["__scopeId","data-v-6a7286f2"]]),Ls={class:"container-pmd"},Ds={class:"mb-3 d-sm-flex justify-content-between"},Vs={class:"row"},Bs={class:"font-hind font-size-10"},Us={key:0},Fs={key:1},qs={class:"col-6"},Ms={class:"col-sm-12"},zs={key:0,class:"col-sm-12"},js={class:"mt-5 mb-3 d-sm-flex justify-content-between"},Gs={class:"row"},Hs={class:"font-hind font-size-10"},Ws={key:0},Ys={key:1},Js={class:"mt-5 mb-3 d-sm-flex justify-content-between"},Xs={class:"row"},Ks={class:"col-6"},Qs={class:"col-6"},Zs={key:0,class:"col-sm-12"},et={key:1,class:"col-sm-12"},st={class:"row"},tt=ee({__name:"Review",props:{errors:{},fields:{default:()=>({})},responsible:{default:()=>({})},student:{default:()=>({})},process:{default:()=>({})}},emits:["edit-student","edit-responsible"],setup(M){const S=M,I=le("$filters"),b=oe(),N=f(!1),R=V(()=>b.getCities),g=V(()=>I.joinAddress(S.responsible.address)),B=V(()=>I.joinAddress(S.responsible.secondAddress)),U=d=>{var a;return(a=b.relationTypes.find(n=>n.key===d))==null?void 0:a.label},T=d=>{var a;return(a=S.process.grades.find(n=>Number(n.id)===Number(d)))==null?void 0:a.name},i=d=>{var a;return(a=S.process.periods.find(n=>Number(n.id)===Number(d)))==null?void 0:a.name},E=d=>{var a;return(a=S.process.schools.find(n=>Number(n.id)===Number(d)))==null?void 0:a.name},x=(d,a)=>{var n;return d[a.key]?(n=R.value.find(l=>l.key==d[a.key]))==null?void 0:n.label:"-"},L=(d,a)=>a.filter(d[a.key]);return(d,a)=>(r(),c("div",Ls,[a[14]||(a[14]=e("h2",{class:"font-muli-20-primary mb-4"}," Confira seus dados antes de finalizar a inscri\xE7\xE3o: ",-1)),e("div",Ds,[a[4]||(a[4]=e("h3",{class:"font-hind-18-primary"}," Dados do(a) respons\xE1vel pelo(a) aluno(a) ",-1)),_(F,{"data-test":"btn-edit-responsible",color:"primary",outline:"",class:"flex-row",label:"Editar dados","no-caps":"","no-wrap":"",onClick:a[0]||(a[0]=n=>d.$emit("edit-responsible"))})]),e("div",Vs,[(r(!0),c(X,null,K(d.fields.responsible,n=>(r(),c("dl",{key:n.id,class:"col-6"},[e("dt",Bs,p(n.field.name),1),n.type!=="CITY"?(r(),c("dd",Us,p(L(d.responsible,n)),1)):(r(),c("dd",Fs,p(x(d.responsible,n)),1))]))),128)),e("dl",qs,[a[5]||(a[5]=e("dt",{class:"font-hind font-size-10"},"Rela\xE7\xE3o com o(a) aluno(a)",-1)),e("dd",null,p(U(d.responsible.relationType)),1)]),e("dl",Ms,[a[6]||(a[6]=e("dt",{class:"font-hind font-size-10"},"Endere\xE7o",-1)),e("dd",null,p(g.value),1)]),d.responsible.secondAddress&&d.responsible.secondAddress.postalCode?(r(),c("dl",zs,[a[7]||(a[7]=e("dt",{class:"font-hind font-size-10"},"Endere\xE7o secund\xE1rio",-1)),e("dd",null,p(B.value),1)])):C("",!0)]),e("div",js,[a[8]||(a[8]=e("h3",{class:"font-hind-18-primary"},"Dados do(a) aluno(a)",-1)),_(F,{"data-test":"btn-edit-student",color:"primary",outline:"",class:"flex-row",label:"Editar dados","no-caps":"","no-wrap":"",onClick:a[1]||(a[1]=n=>d.$emit("edit-student"))})]),e("div",Gs,[(r(!0),c(X,null,K(d.fields.student,n=>(r(),c("dl",{key:n.id,class:"col-6"},[e("dt",Hs,p(n.field.name),1),n.type!=="CITY"?(r(),c("dd",Ws,p(L(d.student,n)),1)):(r(),c("dd",Ys,p(x(d.student,n)),1))]))),128))]),e("div",Js,[a[9]||(a[9]=e("h3",{class:"font-hind-18-primary"},"Dados da pr\xE9-matr\xEDcula",-1)),_(F,{"data-test":"btn-edit-student-2",color:"primary",outline:"",class:"flex-row",label:"Editar dados","no-caps":"","no-wrap":"",onClick:a[2]||(a[2]=n=>d.$emit("edit-student"))})]),e("div",Xs,[e("dl",Ks,[a[10]||(a[10]=e("dt",{class:"font-hind font-size-10"},"S\xE9rie",-1)),e("dd",null,p(T(d.student.grade)),1)]),e("dl",Qs,[a[11]||(a[11]=e("dt",{class:"font-hind font-size-10"},"Turno",-1)),e("dd",null,p(i(d.student.period)),1)]),d.student.school?(r(),c("dl",Zs,[a[12]||(a[12]=e("dt",{class:"font-hind font-size-10"},"Escola",-1)),e("dd",null,p(E(d.student.school)),1)])):C("",!0),d.student.secondSchool?(r(),c("dl",et,[a[13]||(a[13]=e("dt",{class:"font-hind font-size-10"},"Escola (lista de espera)",-1)),e("dd",null,[e("div",null,p(E(d.student.secondSchool))+" ("+p(i(d.student.secondPeriod||d.student.period))+") ",1),(r(!0),c(X,null,K(d.student.waitingList,(n,l)=>(r(),c("div",{key:l},p(E(n.school))+" ("+p(i(n.period))+") ",1))),128))])])):C("",!0)]),e("div",st,[_(z,{modelValue:N.value,"onUpdate:modelValue":a[3]||(a[3]=n=>N.value=n),label:`
        Eu autorizo o uso e tratamento dos dados pessoais acima para fins destinados a pr\xE9-matr\xEDcula na rede municipal
        `,"container-class":"col-12 col-md-8 offset-md-2 mt-4",rules:"required",errors:Boolean(d.errors.accept),name:"accept",type:"CHECKBOX"},null,8,["modelValue","errors"])])]))}}),ot={class:"mt-5"},at={class:"col-12"},lt={key:4,class:"text-danger col-6 offset-3 text-center mt-5 alert alert-danger"},nt={key:0,class:"mt-4"},rt={class:"row"},it={class:"col"},dt={class:"col"},ut={class:"row"},ct={class:"col-6"},pt={class:"col-6"},mt=ee({__name:"PreRegistration",setup(M){var re;const{dialog:S}=be(),{loader:I,data:b}=Q({stage:{},preregistration:void 0}),{data:N,loader:R,loading:g}=Q(),B=(re=Ge())==null?void 0:re.appContext,{loader:U,loading:T}=De(B),{page:i}=Fe(),E=oe(),x=xe(),L=He(),d=f(),a=f([]),n=f({responsible:[],student:[]}),l=f({}),s=f({}),w=f({}),j=f({}),m=f("LOADING"),H=f({}),Y=f(0),O=f(!1),o=f(!1),q=V(()=>({fields:[],buttons:[{type:"button",label:"Voltar",class:"btn btn-block btn-outline-light",containerClass:"offset-md-3 col-md-3",block:!0,action:Se},{type:"submit",label:"Prosseguir",class:"btn btn-block btn-primary",containerClass:"col-md-3 mt-3 mt-md-0",block:!0}],buttonsContainer:{class:"row mt-5"}})),P=le("$filters"),h=f(!1);We(m,u=>{u==="MATCH"?i({path:"/inscricao/dados-do-aluno"}):u==="RESPONSIBLE"?i({path:"/inscricao/dados-do-responsavel"}):u==="STUDENT"?i({path:"/inscricao/dados-do-aluno"}):u==="REVIEW"?i({path:"/inscricao/conferencia-de-dados"}):u==="PROTOCOL"&&i({path:"/inscricao/protocolo"})});const $=()=>{I(()=>{var u,t;return es({id:x.params.id,code:(u=x.query)==null?void 0:u.code,load:!!((t=x.query)!=null&&t.code)})}).then(u=>{if(u.stage.status!=="OPEN"){L.push("/");return}const{fields:t,data:A}=Ve(u.stage.process),{fields:J,data:v}=Be(u.stage.process);if(n.value.responsible=t.sortBy("order"),l.value=A,n.value.student=J.sortBy("order"),s.value=v,!E.isProduction){const se=window.localStorage.getItem("responsible"),te=window.localStorage.getItem("student");se&&(l.value={...A,...JSON.parse(se)}),te&&(s.value={...v,...JSON.parse(te),useSecondSchool:!1})}u.preregistration&&(s.value={...v,...u.preregistration.student},l.value={...A,...u.preregistration.responsible}),w.value={...A},j.value={...v},m.value="MATCH"})},ae=()=>{m.value="MATCH",H.value=l.value,s.value={...j.value}},Se=()=>{m.value==="MATCH"||m.value==="RESPONSIBLE"?L.back():m.value==="STUDENT"?m.value="RESPONSIBLE":m.value==="REVIEW"&&(m.value="STUDENT"),window.scrollTo(0,0)},Te=async u=>{if(m.value==="MATCH")await W.submitMatch(),s.value.responsible_name&&(l.value.responsible_name=s.value.responsible_name),s.value.responsible_cpf&&(l.value.responsible_cpf=s.value.responsible_cpf),s.value.responsible_date_of_birth&&(l.value.responsible_date_of_birth=s.value.responsible_date_of_birth),s.value.responsible_phone&&(l.value.responsible_phone=s.value.responsible_phone);else if(m.value==="RESPONSIBLE"){if(!u.address.lat&&!u.address.lng||u.address.lat===0&&u.address.lng===0)return;l.value={...l.value,...u},W.saveOnStorage(),m.value="STUDENT"}else if(m.value==="STUDENT"){if(s.value={...s.value,...u},W.saveOnStorage(),!W.submitToReview())return}else m.value==="REVIEW"&&await W.submit();window.scrollTo(0,0)},Ce=async()=>{await R(()=>ss({stage:b.value.stage,student:s.value}));const u=N.value.length?N.value[0]:null,t=b.value.stage.restrictionType;if(b.value.stage.process.onePerYear&&u&&u.type==="PRE_REGISTRATION"){S({title:"Aluno(a) possui inscri\xE7\xE3o para o ano",titleClass:"danger",description:"Como o aluno j\xE1 possui uma inscri\xE7\xE3o em aberto para o ano n\xE3o ser\xE1 poss\xEDvel seguir nesta op\xE7\xE3o. Clique em 'Voltar' e efetue a inscri\xE7\xE3o em outro tipo de per\xEDodo."});return}if(t==="NONE"){m.value="RESPONSIBLE";return}if(t==="REGISTRATION_LAST_YEAR"&&u===null){S({title:"Aluno(a) n\xE3o possui matr\xEDcula no ano passado",titleClass:"danger",description:"Como o aluno n\xE3o possui uma matr\xEDcula no ano passado n\xE3o ser\xE1 poss\xEDvel seguir nesta op\xE7\xE3o. Clique em 'Voltar' e efetue a inscri\xE7\xE3o em outro tipo de per\xEDodo."});return}if(t==="REGISTRATION_CURRENT_YEAR"&&u===null){S({title:"Aluno(a) n\xE3o possui matr\xEDcula no ano atual",titleClass:"danger",description:"Como o aluno n\xE3o possui uma matr\xEDcula no ano atual n\xE3o ser\xE1 poss\xEDvel seguir nesta op\xE7\xE3o. Clique em 'Voltar' e efetue a inscri\xE7\xE3o em outro tipo de per\xEDodo."});return}if(t==="NO_REGISTRATION_CURRENT_YEAR"&&u&&u.type==="NO_REGISTRATION_CURRENT_YEAR"){S({title:"Aluno(a) j\xE1 possui matr\xEDcula no ano atual",titleClass:"danger",description:"Como o aluno j\xE1 possui uma matr\xEDcula no ano atual n\xE3o ser\xE1 poss\xEDvel seguir nesta op\xE7\xE3o. Clique em 'Voltar' e efetue a inscri\xE7\xE3o em outro tipo de per\xEDodo."});return}if(t==="NO_REGISTRATION_PERIOD_CURRENT_YEAR"&&u&&u.type==="NO_REGISTRATION_PERIOD_CURRENT_YEAR"){S({title:"Aluno(a) j\xE1 possui matr\xEDcula no turno e ano",titleClass:"danger",description:"Como o aluno j\xE1 possui uma matr\xEDcula no turno e ano do processo n\xE3o ser\xE1 poss\xEDvel seguir nesta op\xE7\xE3o. Clique em 'Voltar' e efetue a inscri\xE7\xE3o em outro tipo de per\xEDodo."});return}if(t==="NEW_STUDENT"&&u&&u.type==="NEW_STUDENT"){S({title:"Aluno(a) j\xE1 possui cadastro na rede",titleClass:"danger",description:"Como o aluno j\xE1 est\xE1 cadastrado na rede n\xE3o ser\xE1 poss\xEDvel seguir nesta op\xE7\xE3o. Clique em 'Voltar' e efetue a inscri\xE7\xE3o em outro tipo de per\xEDodo."});return}u?(s.value.match=u,h.value=!0):m.value="RESPONSIBLE"},we=()=>{m.value="RESPONSIBLE",h.value=!1},Ne=async()=>{var ie,de,ue,ce,pe;const{grade:u,period:t,school:A}=s.value,J=Object.keys(l.value).filter(k=>k.substring(0,6)==="field_"||k.substring(0,12)==="responsible_").map(k=>({field:k,value:l.value[k]?String(l.value[k]):null})),v=Object.keys(s.value).filter(k=>k.substring(0,6)==="field_"||k.substring(0,8)==="student_").map(k=>({field:k,value:s.value[k]?String(s.value[k]):null})),se=s.value.useSecondSchool||((ie=b.value.stage)==null?void 0:ie.type)==="WAITING_LIST"?s.value.secondSchool:null,te=s.value.useSecondSchool||((de=b.value.stage)==null?void 0:de.type)==="WAITING_LIST"?s.value.secondPeriod:null;l.value.address.manualChangeLocation||(l.value.address.manualChangeLocation=!1),l.value.useSecondAddress&&!l.value.secondAddress.manualChangeLocation&&(l.value.secondAddress.manualChangeLocation=!1);const Re={process:(ue=b.value)==null?void 0:ue.stage.process.id,stage:(ce=b.value)==null?void 0:ce.stage.id,type:(pe=b.value)==null?void 0:pe.stage.type,grade:u,period:t,school:A,optionalSchool:se,optionalPeriod:te||t,address:l.value.address,optionalAddress:l.value.useSecondAddress?l.value.secondAddress:null,relationType:l.value.relationType,responsible:J,student:v,externalPerson:s.value.match?s.value.match.id:null,waitingList:s.value.waitingList};U(()=>ts(Re)).then(k=>{a.value=k.preregistrations,m.value="PROTOCOL"})},$e=()=>l.value.responsible_cpf&&s.value.student_cpf&&l.value.responsible_cpf===s.value.student_cpf&&l.value.relationType!=="SELF"?(d.value.$refs.form.setErrors({student_cpf:"CPF igual ao do respons\xE1vel"}),!1):!s.value.school&&!s.value.secondSchool?(d.value.$refs.form.setErrors({atLeastOneSchool:"Uma escola precisa ser selecionada"}),!1):(m.value="REVIEW",!0),Ae=()=>{E.isProduction||setInterval(()=>{window.localStorage.setItem("responsible",JSON.stringify(l.value)),window.localStorage.setItem("student",JSON.stringify(s.value))},5e3)},Ie=({changed:u,secondAddress:t})=>{l.value[t?"secondAddress":"address"].manualChangeLocation=u},ne=u=>{u==="RESPONSIBLE"?(l.value={...w.value,address:ve()},l.value.useSecondAddress&&(l.value.secondAddress=ve(),l.value.useSecondAddress=!1),H.value=l.value):u==="STUDENT"&&(s.value={...j.value},H.value=s.value),Y.value+=1};Ye(()=>$());const W={submitMatch:Ce,saveOnStorage:Ae,submitToReview:$e,submit:Ne};return W.saveOnStorage(),(u,t)=>(r(),c("div",ot,[m.value==="LOADING"?(r(),D(Ue,{key:0})):C("",!0),m.value!=="LOADING"&&m.value!=="PROTOCOL"?(r(),D(ye,{ref_key:"form",ref:d,key:Y.value+"-force-renderer","disable-proceed":O.value||o.value,schema:q.value,loading:y(T)||y(g),"initial-values":H.value,onSubmit:Te},{default:G(({errors:A,setFieldValue:J})=>[e("div",at,[m.value==="MATCH"?(r(),D(us,{key:0,student:s.value,"onUpdate:student":t[0]||(t[0]=v=>s.value=v),fields:n.value,"onUpdate:fields":t[1]||(t[1]=v=>n.value=v),process:y(b).stage.process,stage:y(b).stage,errors:A,class:"container-pmd"},null,8,["student","fields","process","stage","errors"])):C("",!0),m.value==="RESPONSIBLE"?(r(),D(ls,{key:1,fields:n.value.responsible,"onUpdate:fields":t[2]||(t[2]=v=>n.value.responsible=v),responsible:l.value,"onUpdate:responsible":t[3]||(t[3]=v=>l.value=v),fetchingPrimaryAddressLatLng:O.value,"onUpdate:fetchingPrimaryAddressLatLng":t[4]||(t[4]=v=>O.value=v),fetchingSecondaryAddressLatLng:o.value,"onUpdate:fetchingSecondaryAddressLatLng":t[5]||(t[5]=v=>o.value=v),errors:A,"set-field-value":J,class:"container-pmd",onClean:t[6]||(t[6]=v=>ne("RESPONSIBLE"))},null,8,["fields","responsible","fetchingPrimaryAddressLatLng","fetchingSecondaryAddressLatLng","errors","set-field-value"])):C("",!0),m.value==="STUDENT"?(r(),D(ns,{key:2,stage:y(b).stage,"onUpdate:stage":t[7]||(t[7]=v=>y(b).stage=v),fields:n.value.student,"onUpdate:fields":t[8]||(t[8]=v=>n.value.student=v),student:s.value,"onUpdate:student":t[9]||(t[9]=v=>s.value=v),responsible:l.value,"onUpdate:responsible":t[10]||(t[10]=v=>l.value=v),errors:A,class:"container-pmd",onClean:t[11]||(t[11]=v=>ne("STUDENT")),onChangePrimaryAddress:Ie},null,8,["stage","fields","student","responsible","errors"])):C("",!0),m.value==="REVIEW"?(r(),D(tt,{key:3,process:y(b).stage.process,fields:n.value,responsible:l.value,student:s.value,errors:A,onEditResponsible:t[12]||(t[12]=v=>m.value="RESPONSIBLE"),onEditStudent:t[13]||(t[13]=v=>m.value="STUDENT")},null,8,["process","fields","responsible","student","errors"])):C("",!0),Object.keys(A).length>0?(r(),c("div",lt," Preencha todos os campos corretamente ")):C("",!0)])]),_:1},8,["disable-proceed","schema","loading","initial-values"])):C("",!0),_(he,{modelValue:h.value,"onUpdate:modelValue":t[15]||(t[15]=A=>h.value=A),"icon-left":"status-green",title:"Aluno(a) Encontrado(a)","no-footer":""},{body:G(()=>[t[19]||(t[19]=Z(" Confirme se as iniciais do nome e a data de nascimento do(a) aluno(a) est\xE3o corretas: ")),s.value.match?(r(),c("div",nt,[e("div",rt,[e("dl",it,[t[17]||(t[17]=e("dt",{class:"font-hind font-size-10"},"Iniciais",-1)),e("dd",null,p(s.value.match.initials),1)]),e("dl",dt,[t[18]||(t[18]=e("dt",{class:"font-hind font-size-10"},"Data de nascimento",-1)),e("dd",null,p(y(P).formatDate(s.value.match.dateOfBirth)),1)])])])):C("",!0),e("div",ut,[e("div",ct,[_(F,{label:"N\xE3o s\xE3o estas",color:"gray-500",outline:"",class:"w-100","no-caps":"","no-wrap":"",onClick:t[14]||(t[14]=A=>h.value=!1)})]),e("div",pt,[_(F,{label:"Est\xE3o corretas",color:"primary",class:"border-primary w-100","no-caps":"","no-wrap":"",onClick:we})])])]),_:1},8,["modelValue"]),y(b).stage&&m.value==="PROTOCOL"?(r(),D(ks,{key:2,process:y(b).stage.process,"onUpdate:process":t[16]||(t[16]=A=>y(b).stage.process=A),preregistrations:a.value,responsible:l.value,student:s.value,onFinish:ae},null,8,["process","preregistrations","responsible","student"])):C("",!0)]))}}),Rt=Object.freeze(Object.defineProperty({__proto__:null,default:mt},Symbol.toStringTag,{value:"Module"})),vt={class:"row m-0 filter-gutters"},ft={class:"d-flex m-0 mt-3 filter-gutters flex-column flex-lg-row"},bt={key:0,class:"text-white pt-2 pl-2"},Et={class:"d-flex justify-content-end flex-grow-1 mt-2 mt-md-0"},gt={key:1,class:"table table-responsive table-striped table-vcenter"},yt={key:0},ht={key:2,class:"text-center mt-5"},_t={class:"row"},xt={key:0,class:"col-12 text-muted"},St={key:3,class:"row"},Tt={class:"col-8"},Ct=["innerHTML"],wt=ee({__name:"PreRegistrationListPublic",setup(M){const{loader:S}=Q(),{loader:I}=Q(),b=f(!1),N=xe(),R=f([]),g=f(),B=f([]),U=f({status:"WAITING",search:"",process:null,school:null,grade:null,sort:"POSITION",canAcceptInBatch:!1,year:null,schools:null}),T=f({status:"WAITING",search:"",process:null,school:null,grade:null,sort:"POSITION",canAcceptInBatch:!1,year:null,schools:null}),i=f(),E=f(""),x=f([]),L=f([]),d=f([]),a=f(["WAITING","SUMMONED","IN_CONFIRMATION"]),n=f(!1),l=V(()=>{const O={key:null,label:"Nenhum"},o=d.value.map(q=>({key:q.id,label:q.name}));return o.unshift(O),o}),s=V(()=>{const O={key:null,label:"Nenhum"},o=a.value.map(q=>({key:q,label:fe(q)}));return o.unshift(O),o}),w=V(()=>n.value===!1&&B.value.length===0),j=O=>{n.value=!0,b.value=!0;const o={...T.value,page:O};Object.keys(o).forEach(P=>{(!o[P]||o[P]==="")&&delete o[P]}),["period","process","school","grade"].forEach(P=>{let h=o[P];Number(h)||delete o[P]}),S(()=>os({...o,first:50,process:N.params.id})).then(P=>{if(!P)return;B.value=P.preregistrations,g.value=P.paginator,R.value=[];const{process:h,school:$,grade:ae}=T.value;h&&$&&ae&&(T.value.canAcceptInBatch=!0)}).finally(()=>{n.value=!1})},m=()=>{T.value={...U.value},j(1)},H=()=>{const O={id:N.params.id};I(()=>as(O)).then(o=>{E.value=o.criteria,i.value=o,x.value=o.schools.sortBy("name"),L.value=o.grades.sortBy("name"),d.value=o.periods.sortBy("name")})},Y=V(()=>{var O;return(O=i.value)==null?void 0:O.fields.filter(o=>o.weight!==0).sortBy("weigth")});return H(),(O,o)=>{var P;const q=Je("tooltip");return r(),c("main",null,[o[14]||(o[14]=e("h1",null,"Consulta da lista de espera",-1)),_(ge,{class:"bg-primary mt-4 mb-3"},{default:G(()=>[_(Ee,{class:"pl-2 pr-2"},{default:G(()=>{var h;return[e("form",{onSubmit:o[7]||(o[7]=Xe($=>j(1),["prevent"]))},[e("div",vt,[_(z,{modelValue:T.value.school,"onUpdate:modelValue":o[0]||(o[0]=$=>T.value.school=$),"container-class":"col-12 col-md-3 mb-2 mb-md-0",name:"school",placeholder:"Filtrar por escola",type:"SELECT",options:x.value,searchable:"",onChange:o[1]||(o[1]=$=>T.value.canAcceptInBatch=!1)},null,8,["modelValue","options"]),_(z,{modelValue:T.value.grade,"onUpdate:modelValue":o[2]||(o[2]=$=>T.value.grade=$),"container-class":"col-12 col-md-3 mb-2 mb-md-0",name:"grade",placeholder:"Filtrar por s\xE9rie",type:"SELECT",options:L.value,searchable:"",onChange:o[3]||(o[3]=$=>T.value.canAcceptInBatch=!1)},null,8,["modelValue","options"]),_(z,{modelValue:T.value.period,"onUpdate:modelValue":o[4]||(o[4]=$=>T.value.period=$),"container-class":"col-12 col-md-3 mb-2 mb-md-0",name:"period",placeholder:"Filtrar por turno",type:"SELECT",options:l.value},null,8,["modelValue","options"]),_(z,{modelValue:T.value.status,"onUpdate:modelValue":o[5]||(o[5]=$=>T.value.status=$),"container-class":"col-12 col-md-3 mb-2 mb-md-0",name:"status",placeholder:"Filtrar por status",type:"SELECT",options:s.value},null,8,["modelValue","options"])]),e("div",ft,[g.value?(r(),c("p",bt," Total de alunos(as) em espera: "+p((h=g.value)==null?void 0:h.total),1)):C("",!0),e("div",Et,[_(F,{"data-test":"cleanFilter",label:"Limpar",color:"white",flat:"",class:"mr-3","no-caps":"","no-wrap":"",onClick:m}),_(F,{"data-test":"btn-search-pre-registration",label:"Buscar",color:"white",outline:"",class:"mr-2","no-caps":"","no-wrap":"",loading:n.value,"loading-normal":"",onClick:o[6]||(o[6]=$=>j(1))},null,8,["loading"])])])],32)]}),_:1})]),_:1}),n.value?(r(),D(ze,{key:0})):!n.value&&b.value?(r(),c("table",gt,[o[10]||(o[10]=e("thead",null,[e("tr",null,[e("th",null,"Status"),e("th",null,"Posi\xE7\xE3o"),e("th",null,"Iniciais do(a) aluno(a)"),e("th",null,"Escola"),e("th",null,"S\xE9rie"),e("th",null,"Turno")])],-1)),e("tbody",null,[w.value?(r(),c("tr",yt,o[9]||(o[9]=[e("td",{colspan:"9"},"Nenhum resultado.",-1)]))):(r(!0),c(X,{key:1},K(B.value,h=>{var $;return r(),c("tr",{key:h.id},[e("td",null,[Ke(e("span",{class:Qe(y(qe)(h.status))},null,2),[[q,y(fe)(h.status),void 0,{"bottom-start":!0}]])]),e("td",null,p(h.position)+"\xBA",1),e("td",null,p(($=h.student)==null?void 0:$.initials.toUpperCase()),1),e("td",null,p(h.school.name),1),e("td",null,p(h.grade?h.grade.name:"-"),1),e("td",null,p(h.period?h.period.name:"-"),1)])}),128))])])):(r(),c("div",ht,o[11]||(o[11]=[e("p",null,"Para ter acesso a lista de espera, utilize os filtros acima.",-1),e("p",null," Recomendamos o uso dos campos Escola, S\xE9rie, para uma melhor visualiza\xE7\xE3o. ",-1)]))),_(Me,{"paginator-info":g.value,onPage:o[8]||(o[8]=h=>j(h))},null,8,["paginator-info"]),e("div",_t,[((P=Y.value)==null?void 0:P.length)===0?(r(),c("div",xt," Nenhum crit\xE9rio de prioridade foi definido. ")):C("",!0)]),Y.value?(r(),c("div",St,[o[12]||(o[12]=e("div",{class:"col-12"},[e("h1",{class:"mt-5 text-center",style:{"font-size":"26px"}}," Crit\xE9rios de prioriza\xE7\xE3o da lista de espera ")],-1)),o[13]||(o[13]=e("div",{class:"col-2"},null,-1)),e("div",Tt,[e("div",{class:"row mt-2 text-justify",innerHTML:E.value},null,8,Ct)])])):C("",!0)])}}}),Ot=Object.freeze(Object.defineProperty({__proto__:null,default:wt},Symbol.toStringTag,{value:"Module"}));export{Rt as P,Ot as a};
